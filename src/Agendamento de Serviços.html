<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dogs & Cats - Agendamento de Serviços</title>
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="./Logo_sem_fundo.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;500;600&family=Roboto:wght@400;500&display=swap"
    rel="stylesheet">
</head>

<body style="background-color: #175EA8;">
  <!-- Início header -->

  <nav class="navbar navbar-expand-sm px-4 py-0" style="background-color: #F9E6B3;">
    <div class="container-fluid">
      <a class="navbar-brand" href=""><img src="../src/imagens/Logo_sem_fundo.png" alt="" height="110px"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
        <ul class="navbar-nav text-center">
          <li class="nav-item">
            <a class="nav-link text-black" href="#">
              <img src="../src/imagens/home.png" alt="" height="45px">
              <br>
              <b>Início</b>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="#">
              <img src="../src/imagens/livro.png" alt="" height="45px">
              <br>
              <b>Agenda</b>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link  text-black" href="#">
              <img src="../src/imagens/pata.png" alt="" height="45px">
              <br>
              <b>Pets</b>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="#">
              <img src="../src/imagens/usuario.png" alt="" height="45px">
              <br>
              <b>Perfil</b>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="#">
              <img src="../src/imagens/sair.png" alt="" height="45px">
              <br>
              <b>Sair</b>
            </a>
          </li>
        </ul>
      </div>

    </div>


  </nav>
  <!-- Fim header -->

  <body>
    <!-- Início main -->
    <main>
      <section class="sectionmain">
        <h2>Agendamento de Serviços</h2>
        <form id="agendamentoForm">
          <div class="form-group">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>
          </div>
          <div class="form-group">
            <label for="nomePet">Nome do Pet:</label>
            <input type="text" id="nomePet" name="nomePet" required>
          </div>
          <div class="form-group">
            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" name="telefone" required>
          </div>
          <div class="form-group">
            <label for="servico">Serviço:</label>
            <select id="servico" name="servico" required>
              <option value="">Selecione um serviço</option>
              <option value="Banho/Tosa">Banho/Tosa (50$)</option>
              <option value="Atendimento Veterinario">Atendimento Veterinario (100$)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="data">Data:</label>
            <input type="date" id="data" name="data" required>
          </div>
          <div class="form-group">
            <label for="horario">Horário:</label>
            <select id="horario" name="horario" required>
              <option value="">Selecione um horário</option>
            </select>
          </div>
          <button type="submit" class="submeter">Agendar</button>
        </form>
      </section>
    </main>
    <!-- Fim main -->

    <!-- Início aside -->
    <aside style="display: none; margin-bottom: 20px; background-color: #175EA8;" id="agendamentoAside">
      <section>
        <!-- Cartão de Agendamento -->
        <div class="cardContainer">

          <!-- Conteúdo do cartão -->
        </div>
        <style>
          .cardContainer {
            text-align: left;
            max-width: 600px;
            width: 90%;
            padding: 2em;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            background-color: #808080;
            margin: 0 auto;
          }
        </style>
      </section>
    </aside>
    <!-- Fim aside -->

    <!-- Início footer -->
    <div class="container-fluid" style="background-color: #F9E6B3;" id="rodape">
      <div class="row mt-5 ms-5 justify-content-center " id="rodape2">
        <div class="col-md-6 col-lg-3 mt-4">
          <h6 class="text-black"><strong>Métodos de pagamento</strong></h6>
          <i class="fa fa-cc-mastercard" style="font-size:36px; color: #000000;"></i>
          <i class="fa fa-cc-visa" style="font-size:36px; color: #000000;"></i>
          <i class="fa fa-money" style="font-size:36px; color: #000000;"></i>
        </div>

        <div class="col-md-6 col-lg-3 mt-4">
          <h6 class="text-black"><strong>Funcionamento</strong></h6>
          <p>Segunda à Sexta - 08:00 às 18:00</p>
          <p>Sábado - 08:00 às 14:00</p>
          Domingo e Feriado - Fechado
        </div>

        <div class="col-md-6 col-lg-2 mt-4">
          <h6 class="text-black"><strong>Redes sociais</strong></h6>
          <a href="https://pt-br.facebook.com/" target="_blank"><i class="fa fa-facebook"
              style="color: #000000; font-size:36px"></i></a>
          <a href="https://www.instagram.com/" target="_blank"><i class="fa fa-instagram"
              style="color: #000000; font-size:36px"></i></a>
          <a href="https://api.whatsapp.com/send?phone=5531998765432" target="_blank"><i class="fa fa-whatsapp"
              style="color: #000000; font-size:36px"></i></a>
        </div>

        <div class="col-md-6 col-lg-3 mt-4 mb-4">
          <h6 class="text-black"><strong>Entre em contato</strong></h6>
          <i class="fa fa-map-marker ps-1 pe-2" style="color: #000000; font-size:22px"></i>Rua Jardins, 57, Savassi,
          BH<br>
          <i class="fa fa-envelope mt-2 pe-1" style="font-size:22px; color: #000000;"></i> <a
            href="mailto:dogsecats@gmail.com">dogsecats@gmail.com</a><br>
          <i class="fa fa-phone mt-2 ps-1 pe-2" style="color: #000000; font-size:22px"></i>(31) 3345-9876
        </div>
      </div>
      <footer style="background-color: #f8e2a7; text-align: center;">
        <i class="fa fa-copyright" style="font: size 22px; color: #000000;"> <strong> Dogs&Cats - 2023</strong></i>
      </footer>
    </div>
    <!-- Fim footer -->

    <!-- Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmationModalLabel">Confirmação de Agendamento</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Agendamento realizado com sucesso! Nós entraremos em contato para confirmar.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Verificar se há horários agendados armazenados no local storage
      let agendamentos = localStorage.getItem('agendamentos');
      if (!agendamentos) {
        // Se não houver nenhum agendamento armazenado, criar uma lista vazia
        agendamentos = [];
      } else {
        // Se houver agendamentos armazenados, converter para uma lista de objetos
        agendamentos = JSON.parse(agendamentos);
      }

      // Função para verificar se um horário está disponível
      function isHorarioDisponivel(data, horario) {
        // Verificar se já existe um agendamento para a data e horário fornecidos
        for (let i = 0; i < agendamentos.length; i++) {
          if (agendamentos[i].data === data && agendamentos[i].horario === horario) {
            return false; // Horário indisponível
          }
        }
        return true; // Horário disponível
      }

      // Manipular o envio do formulário
      const form = document.getElementById('agendamentoForm');
      form.addEventListener('submit', function (event) {
        event.preventDefault(); // Impedir o envio padrão do formulário
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        data.nomePet = document.getElementById('nomePet').value;
        console.log(data); // Exemplo: exibir dados no console

        // Verificar se o horário está disponível
        if (!isHorarioDisponivel(data.data, data.horario)) {
          alert('Desculpe, o horário selecionado já está indisponível. Por favor, escolha outro horário.');
          return; // Impedir o processamento adicional do formulário
        }

        // Atualizar a lista de agendamentos
        agendamentos.push({
          data: data.data,
          horario: data.horario
        });

        // Armazenar a lista de agendamentos atualizada no local storage
        localStorage.setItem('agendamentos', JSON.stringify(agendamentos));

        // Restante do código para gerar o cartão com as informações do agendamento
        gerarCartao(data);

        const aside = document.getElementById('agendamentoAside');
        aside.style.display = 'block';

        var confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
        confirmationModal.show();
      });

      // Função para gerar o cartão com as informações do agendamento
      function gerarCartao(data) {
        const card = document.createElement('div');
        card.className = 'card my-3';

        const cardContent = `
          <h2 class="text-center">Serviço Agendado</h2>
          <div class="row justify-content-center">
            <div class="col-md-6 text-center">
              <img src="imagens/medico.png" alt="" class="pt-4 pb-1" width="100px" id="imgcard">
            </div>
            <div class="col-md-6 text-center">
              <p class="pt-4"><strong>${data.nome}</strong></p>
              <p><strong>${data.telefone}</strong></p>
              <p><strong>${data.nomePet}</strong></p>
              <p><strong>${data.servico}</strong></p>
              <p><strong>${formatarData(data.data)}</strong></p>
              <p><strong>${data.horario}</strong></p>
            </div>
          </div>
        `;

        card.innerHTML = cardContent;

        const imgCard = card.querySelector('#imgcard');

        if (data.servico === 'Atendimento Veterinario') {
          imgCard.src = 'imagens/vetpet.png';
        } else if (data.servico === 'Banho/Tosa') {
          imgCard.src = 'imagens/bathtub.png';
        }

        const cardContainer = document.querySelector('#agendamentoAside .cardContainer');
        cardContainer.appendChild(card);
      }

      function formatarData(data) {
        const dataObj = new Date(data);
        const dia = String(dataObj.getDate()).padStart(2, '0');
        const mes = String(dataObj.getMonth() + 1).padStart(2, '0');
        const ano = dataObj.getFullYear();
        return `${dia}/${mes}/${ano}`;
      }

      const dateInput = document.getElementById('data');
      const timeInput = document.getElementById('horario');

      // Atualiza as opções de horário
      function updateTimeOptions(day) {
        let start, end;
        if (day >= 0 && day <= 4) { // Segunda à Sexta
          start = 8;
          end = 18;
        } else if (day === 5) { // Sábado
          start = 8;
          end = 14;
        } else { // Domingo
          start = null;
          end = null;
        }
        // Limpa opções existentes
        while (timeInput.firstChild) {
          timeInput.removeChild(timeInput.firstChild);
        }
        // Cria opção de seleção
        let option = document.createElement('option');
        option.text = "Selecione um horário";
        option.value = "";
        timeInput.add(option);
        // Adiciona novas opções
        if (start !== null && end !== null) {
          for (let i = start; i < end; i++) {
            for (let j = 0; j < 2; j++) {
              let option = document.createElement('option');
              option.text = `${i.toString().padStart(2, '0')}:${j === 0 ? '00' : '30'}`;
              option.value = option.text;
              timeInput.add(option);
            }
          }
        }
      }

      dateInput.addEventListener('change', function (event) {
        const selectedDate = new Date(this.value);
        updateTimeOptions(selectedDate.getDay());
      });

      let today = new Date();
      let dd = String(today.getDate()).padStart(2, '0');
      let mm = String(today.getMonth() + 1).padStart(2, '0');
      let yyyy = today.getFullYear();
      today = yyyy + '-' + mm + '-' + dd;

      let nextYear = new Date();
      nextYear.setFullYear(nextYear.getFullYear() + 1);
      let next_dd = String(nextYear.getDate()).padStart(2, '0');
      let next_mm = String(nextYear.getMonth() + 1).padStart(2, '0');
      let next_yyyy = nextYear.getFullYear();
      nextYear = next_yyyy + '-' + next_mm + '-' + next_dd;

      dateInput.setAttribute('min', today);
      dateInput.setAttribute('max', nextYear);
    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"></script>
  </body>

</html>